!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],t):t(e["visualization-points"]={},e.ng.core,e.ng.common)}(this,function(e,t,n){"use strict";function i(e,t){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var o=function(){function e(){this.points=[]}return e.prototype.targetKeysFromGeneratedPoints=function(e,t){var n=[];return e.map(function(e){var i=e.key.split("."),o=t,a=!1;i.map(function(e){0===e.length||o instanceof Array?(o=undefined,a=!0):o=o?o[e]:o}),a||n.push(JSON.parse(JSON.stringify(e)))}),n},e.prototype.generatePoints=function(e,t,n){var i=this;return n&&(this.points=[]),null!==e&&Object.keys(e).map(function(n){var o=t.length?t+"."+n:n;if("string"==typeof e[n]||"number"==typeof e[n]||"boolean"==typeof e[n])i.points.push({key:o,value:i.makeWords(o)});else if(e[n]instanceof Array){var a=e[n];!a.length||a[0]instanceof Array||"string"==typeof a[0]?i.points.push({key:o,value:i.makeWords(o)}):i.generatePoints(a[0],o,!1)}else i.generatePoints(e[n],o,!1)}),this.points},e.prototype.makeWords=function(e){return e.replace(/\./g," ~ ").replace(/([A-Z])/g," $1").replace(/-/g," ").replace(/_/g," ").replace(/^./,function(e){return e.toUpperCase()})},e}();o.decorators=[{type:t.Injectable}],o.ctorParameters=function(){return[]};var a=function(){function e(){}return e.prototype.pushIfNotContain=function(e,t){var n=!1;e.map(function(e){e.name.indexOf(t.name)>-1&&(n=!0)}),n||e.push(t)},e.prototype.pushInList=function(e,t,n,i,o,a){var r=this,s=undefined;t="string"==typeof(t=t instanceof Array?t.join(""):t)?t.trim().length?t:"BLANK":"boolean"==typeof t?t?"true":"false":null===t?"NULL":t,e.map(function(e){e.name===t&&(s=e,r.pushIfNotContain(e.children,a))}),null!==t&&(s?o?s.children.push(a):i&&e.push({name:t,data:n,children:[a]}):e.push({name:t,data:n,children:[a]}))},e.prototype.eveluate=function(e,t){for(var n=this,i=function(i){if((e=e?e[t[i]]:e)instanceof Array){var o=[];return e.map(function(e){o.push(n.eveluate(e,t.slice(i+1,t.length)))}),e=o,"break"}},o=0;o<t.length;o++){if("break"===i(o))break}return e},e.prototype.eveluatedNode=function(e,t){for(var n=this,i=function(i){if((e=e?e[t[i]]:e)instanceof Array){var o=[];return e.map(function(e){o.push(n.eveluate(e,t.slice(i+1,t.length)))}),e=o,"break"}},o=0;o<t.length-1;o++){if("break"===i(o))break}return e},e.prototype.makeWords=function(e){return e.replace(/([A-Z])/g," $1").replace(/-/g," ").replace(/_/g," ").replace(/^./,function(e){return e.toUpperCase()})},e.prototype.evaluatePoints=function(e,t,n,i,o){var a=this,r={};t.map(function(e){r[e.value]=[]}),e.map(function(e){var s=[];n.map(function(t){var n=t.key.split("."),i=e;n.map(function(e){i=i?i[e]:i}),i=null===i?"NULL":i,s.push(String(i))}),(s=s.length?s.join(", "):undefined)&&t.map(function(t){var n=t.key.split("."),l=r[t.value],p=a.eveluate(e,n),c=a.eveluatedNode(e,n);p instanceof Array?p.map(function(e,t){a.pushInList(l,e,c[t],i,o,{name:s})}):a.pushInList(l,p,c,i,o,{name:s})})});var s=[];return Object.keys(r).map(function(e){s.push({name:a.makeWords(e),children:r[e]})}),{name:"/",children:s}},e}();a.decorators=[{type:t.Injectable}],a.ctorParameters=function(){return[]};var r=function(){function e(e,n){this.pointMaker=e,this.evaluator=n,this.evaluatedPoints={},this.interestingPoints=[],this.targetKeys=[],this.allowduplicates=!1,this.groupduplicates=!1,this.settings={tooltipEnabled:!1,directionality:"L2R",nodeType:"Plain",targetDiv:"#d3-container",styles:{links:{colors:{"default":"gray",hover:"#fcb2b2",selected:"red"}},nodes:{colors:{"default":"#fff",hover:"#fcb2b2",selected:"lightsteelblue"}}}},this.onVisualization=new t.EventEmitter}return e.prototype.sizeUp=function(e){var t=this,n=e.children&&e.children.length?e.children.length:undefined;return n&&(e.name+=e.children.length>1?" ("+n+")":"",e.children.map(function(e){t.sizeUp(e)})),e},e.prototype.triggerEvaluation=function(e,t){if(e.length&&t.length){this.d3Container.nativeElement.innerHTML="",this.evaluatedPoints=this.evaluator.evaluatePoints(this.data,e,t,this.allowduplicates,this.groupduplicates);var n=this.sizeUp(JSON.parse(JSON.stringify(this.evaluatedPoints)));window.initiateD3(n,this.settings),this.onVisualization.emit(this.evaluatedPoints)}else this.d3Container.nativeElement.innerHTML="",this.onVisualization.emit([])},e.prototype.ngOnChanges=function(e){e.data&&(this.interestingPoints=undefined,this.targetKeys=undefined,setTimeout(this.ngOnInit.bind(this),333))},e.prototype.findReferenceStructureFrom=function(e){var t,n=0;return e.map(function(e){var i=e?Object.keys(e).length:0;i>n&&(n=i,t=e)}),t},e.prototype.ngOnInit=function(){if(this.data instanceof Array||(this.data=[this.data]),this.data.length&&this.enableConfiguration){var e=this.findReferenceStructureFrom(this.data),t=this.pointMaker.generatePoints(e,"",!0);this.interestingPoints=t,this.targetKeys=this.pointMaker.targetKeysFromGeneratedPoints(t,e)}this.triggerEvaluation(this.sanitize(this.interestingPoints),this.sanitize(this.targetKeys))},e.prototype.ngAfterViewInit=function(){return e=this,t=void 0,o=function(){return i(this,function(e){switch(e.label){case 0:return window.initiateD3?[3,2]:[4,this.loadScript("assets/d3.js","d3js")];case 1:e.sent(),e.label=2;case 2:return[2]}})},new((n=void 0)||(n=Promise))(function(i,a){function r(e){try{l(o.next(e))}catch(t){a(t)}}function s(e){try{l(o["throw"](e))}catch(t){a(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(r,s)}l((o=o.apply(e,t||[])).next())});var e,t,n,o},e.prototype.loadScript=function(e,t){return new Promise(function(t,n){var i=document.createElement("script");i.type="text/javascript",i.src=e,i.onload=t,document.body.appendChild(i)})},e.prototype.sanitize=function(e){var t=[];return e&&e.length&&e.map(function(e){e.selected&&t.push({key:e.key,value:e.value})}),t},e.prototype.onchange=function(e){this.allowduplicates=e.allowduplicates,this.groupduplicates=e.groupduplicates,this.settings=e.configuration,this.triggerEvaluation(this.sanitize(e.points),this.sanitize(e.keys))},e}();r.decorators=[{type:t.Component,args:[{selector:"visualization-points",template:'\n<div class="configuration" *ngIf="enableConfiguration && interestingPoints">\n    <visualization-configuration\n        [interestingPoints]="interestingPoints"\n        [targetKeys]="targetKeys"\n        [configuration]="settings"\n        [allowduplicates]="allowduplicates"\n        [groupduplicates]="groupduplicates"\n        (onchange)="onchange($event)"></visualization-configuration>\n</div>\n<div class="d3-container" id="d3-container" #d3Container></div>\n',styles:[":host{\n  -webkit-box-sizing:border-box;\n          box-sizing:border-box;\n  display:table;\n  position:relative;\n  width:100%; }\n  :host #d3-container{\n    border:1px solid #633;\n    padding:0 5px;\n    -webkit-box-sizing:border-box;\n            box-sizing:border-box;\n    border-radius:5px;\n    background-color:#fefefe;\n    margin:5px; }\n  :host ::ng-deep .node circle{\n    cursor:pointer;\n    fill:#fff;\n    stroke:steelblue;\n    stroke-width:1.5px; }\n  :host ::ng-deep .node rect{\n    cursor:pointer;\n    fill:#fff;\n    stroke:steelblue;\n    stroke-width:1.5px; }\n  :host ::ng-deep div.tooltip{\n    position:absolute;\n    padding:5px;\n    font:12px sans-serif;\n    background:#cfcfcf;\n    border:1px solid #3a3939;\n    border-radius:4px;\n    pointer-events:none;\n    z-index:5; }\n  :host ::ng-deep .node text{\n    font-size:11px;\n    font-weight:bold; }\n  :host ::ng-deep path.link{\n    fill:none;\n    stroke:#ccc;\n    stroke-width:1.5px; }\n"]}]}],r.ctorParameters=function(){return[{type:o},{type:a}]},r.propDecorators={interestingPoints:[{type:t.Input,args:["interestingPoints"]}],targetKeys:[{type:t.Input,args:["targetKeys"]}],data:[{type:t.Input,args:["data"]}],allowduplicates:[{type:t.Input,args:["allowduplicates"]}],groupduplicates:[{type:t.Input,args:["groupduplicates"]}],settings:[{type:t.Input,args:["settings"]}],enableConfiguration:[{type:t.Input,args:["enableConfiguration"]}],onVisualization:[{type:t.Output,args:["onVisualization"]}],d3Container:[{type:t.ViewChild,args:["d3Container"]}]};var s=function(){function e(e){this.renderer=e,this.interestingPoints=[],this.targetKeys=[],this.allowduplicates=!1,this.configuration={tooltipEnabled:!1,directionality:"L2R",nodeType:"Plain",targetDiv:"#d3-container",styles:{links:{colors:{"default":"gray",hover:"#fcb2b2",selected:"red"}},nodes:{colors:{"default":"#fff",hover:"#fcb2b2",selected:"lightsteelblue"}}}},this.groupduplicates=!1,this.onchange=new t.EventEmitter}return e.prototype.keyup=function(e){13===e.which&&this.renderer.invokeElementMethod(e.target,"click")},e.prototype.chaneDirectionality=function(e){this.configuration.directionality=e.target.value,this.emitChange()},e.prototype.changeNodeType=function(e){this.configuration.nodeType=e.target.value,this.emitChange()},e.prototype.changeColorSets=function(e){1==e.target.value?(this.configuration.styles.links.colors={"default":"gray",hover:"#fcb2b2",selected:"red"},this.configuration.styles.nodes.colors={"default":"#fff",hover:"#fcb2b2",selected:"lightsteelblue"}):(this.configuration.styles.links.colors={"default":"green",hover:"#cad2d2",selected:"#f58c24"},this.configuration.styles.nodes.colors={"default":"yellow",hover:"#cad2d2",selected:"blue"}),this.emitChange()},e.prototype.click=function(e,t){var n=e.target;"allowduplicates"===t?(this.allowduplicates=n.checked,this.groupduplicates=!!this.allowduplicates&&this.groupduplicates):"groupduplicates"===t?(this.groupduplicates=n.checked,this.allowduplicates=!!this.groupduplicates||this.allowduplicates):"tooltipEnabled"===t?this.configuration.tooltipEnabled=n.checked:t.selected=n.checked,this.emitChange()},e.prototype.emitChange=function(){this.onchange.emit({points:this.interestingPoints,keys:this.targetKeys,allowduplicates:this.allowduplicates,configuration:this.configuration})},e}();s.decorators=[{type:t.Component,args:[{selector:"visualization-configuration",template:'<p class="info">\n    <span>\n        Pick points are the attributes in which you want to evaluate.\n        Target keys are the attributes in which evaluated data will be presented on.\n    </span>\n    <span>\n        For example: if you are examining users and pick user age and city as pick points,\n        data will be evaluated on city and age. And if you pick user name and gender as target keys,\n        for each age and city reference, you will see the resulting data as name and age values.</span>\n</p>\n<fieldset class="pick-points">\n    <legend>Target Keys:</legend>\n    <label *ngFor="let x of targetKeys; let i = index" [for]="\'targetKey\' + i">\n        <input\n            type="checkbox"\n            name="targetKey"\n            [id]="\'targetKey\' + i"\n            [value]="x.value"\n            [checked]="x.selected ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, x)" />\n        <span [textContent]="x.value"></span>\n    </label>\n</fieldset>\n<fieldset class="pick-points">\n    <legend>Pick Points:</legend>\n    <label *ngFor="let x of interestingPoints; let i = index" [for]="\'pickpoint\' + i">\n        <input\n            type="checkbox"\n            name="pickpoint"\n            [id]="\'pickpoint\' + i"\n            [value]="x.value"\n            [checked]="x.selected ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, x)" />\n        <span [textContent]="x.value"></span>\n    </label>\n</fieldset>\n<fieldset class="pick-points default">\n    <legend>Presentation:</legend>\n    <label for="directionality">Directionality:</label>\n    <select name="directionality"\n            id="directionality"\n            (change)="chaneDirectionality($event)">\n        <option value="L2R">Left to Right</option>\n        <option value="R2L">Right to Left</option>\n        <option value="TD">Top Down</option>\n    </select>\n    <label for="nodeType">Node Type:</label>\n    <select name="nodeType"\n            id="nodeType"\n            (change)="changeNodeType($event)">\n        <option value="Plain">Plain</option>\n        <option value="Rectangle">Rectangle</option>\n        <option value="Circle">Circle</option>\n    </select>\n    <label for="colorSets">Color sets:</label>\n    <select name="colorSets"\n            id="colorSets"\n            (change)="changeColorSets($event)">\n        <option value="1">Sample 1</option>\n        <option value="2">Sample 2</option>\n    </select>\n    <label for="tooltip">\n        <input\n            type="checkbox"\n            name="tooltip"\n            id="tooltip"\n            [checked]="tooltipEnabled ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, \'tooltipEnabled\')" />\n        <span>Enable Tool tip</span>\n    </label>\n</fieldset>\n<fieldset class="pick-points">\n    <legend>Duplicates In result set:</legend>\n    <label for="allowduplicates">\n        <input\n            type="checkbox"\n            name="allowduplicates"\n            id="allowduplicates"\n            [value]="allowduplicates"\n            [checked]="allowduplicates ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, \'allowduplicates\')" />\n        <span>Allow Duplicates</span>\n    </label>\n    <label for="groupduplicates">\n        <input\n            type="checkbox"\n            name="groupduplicates"\n            id="groupduplicates"\n            [value]="groupduplicates"\n            [checked]="groupduplicates ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, \'groupduplicates\')" />\n        <span>Group Duplicates</span>\n    </label>\n</fieldset>\n',styles:[":host{\n  -webkit-box-sizing:border-box;\n          box-sizing:border-box;\n  display:table;\n  padding:5px; }\n  :host .info{\n    padding:5px 0;\n    margin:0;\n    font-size:0.9em; }\n  :host .pick-points{\n    -webkit-box-sizing:border-box;\n            box-sizing:border-box;\n    border:1px solid #633;\n    display:block;\n    float:left;\n    padding:0 0 5px 0;\n    width:100%;\n    margin:0;\n    border-radius:5px;\n    background-color:#fefefe; }\n    :host .pick-points legend{\n      font-weight:bold;\n      margin-left:20px;\n      color:#633; }\n    :host .pick-points label{\n      display:inline-table;\n      width:24.33%; }\n      :host .pick-points label:hover{\n        color:#ca0000; }\n    :host .pick-points.default label{\n      width:15%;\n      text-align:right; }\n"]}]}],s.ctorParameters=function(){return[{type:t.Renderer}]},s.propDecorators={interestingPoints:[{type:t.Input,args:["interestingPoints"]}],targetKeys:[{type:t.Input,args:["targetKeys"]}],allowduplicates:[{type:t.Input,args:["allowduplicates"]}],configuration:[{type:t.Input,args:["configuration"]}],groupduplicates:[{type:t.Input,args:["groupduplicates"]}],onchange:[{type:t.Output,args:["onchange"]}]};var l=function(){return function(){}}();l.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule],declarations:[r,s],exports:[r,s],entryComponents:[r,s],providers:[o,a],schemas:[t.CUSTOM_ELEMENTS_SCHEMA]}]}],l.ctorParameters=function(){return[]},e.VisualizationPointsComponent=r,e.VisualizationConfigurationComponent=s,e.VisualizationPointsModule=l,e.ɵb=a,e.ɵa=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=visualization-points.umd.min.js.map
