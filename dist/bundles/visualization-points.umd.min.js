!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],e):e(n["visualization-points"]={},n.ng.core,n.ng.common)}(this,function(n,e,t){"use strict";function i(n,e){var t,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(n,a)}catch(s){r=[6,s],i=0}finally{t=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var o=function(){function n(){this.points=[]}return n.prototype.generatePoints=function(n,e,t){var i=this;return t&&(this.points=[]),Object.keys(n).map(function(t){var o=e.length?e+"."+t:t;if("string"==typeof n[t]||"number"==typeof n[t]||"boolean"==typeof n[t])i.points.push({key:o,value:i.makeWords(o)});else if(n[t]instanceof Array){var r=n[t];!r.length||r[0]instanceof Array||"string"==typeof r[0]?i.points.push({key:o,value:i.makeWords(o)}):i.generatePoints(r[0],o,!1)}else i.generatePoints(n[t],o,!1)}),this.points},n.prototype.makeWords=function(n){return n.replace(/\./g," ").replace(/([A-Z])/g," $1").replace(/-/g," ").replace(/_/g," ").replace(/^./,function(n){return n.toUpperCase()})},n}();o.decorators=[{type:e.Injectable}],o.ctorParameters=function(){return[]};var r=function(){function n(){}return n.prototype.pushIfNotContain=function(n,e){var t=!1;n.map(function(n){n.name.indexOf(e.name)>-1&&(t=!0)}),t||n.push(e)},n.prototype.pushInList=function(n,e,t){var i=this,o=!1;n.map(function(n){n.name===e&&(o=!0,i.pushIfNotContain(n.children,t))}),o||n.push({name:e,children:[t]})},n.prototype.eveluate=function(n,e){for(var t=this,i=function(i){if((n=n[e[i]])instanceof Array){var o=[];return n.map(function(n){o.push(t.eveluate(n,e.slice(i+1,e.length)))}),n=o,"break"}},o=0;o<e.length;o++){if("break"===i(o))break}return n},n.prototype.makeWords=function(n){return n.replace(/([A-Z])/g," $1").replace(/-/g," ").replace(/_/g," ").replace(/^./,function(n){return n.toUpperCase()})},n.prototype.evaluatePoints=function(n,e,t){var i=this,o={};e.map(function(n){o[n.value]=[]}),n.map(function(n){var r=[];t.map(function(e){var t=e.key.split("."),i=n;t.map(function(n){i=i[n]}),r.push(i)}),r=r.join(", "),e.map(function(e){var t=e.key.split("."),a=o[e.value],s=i.eveluate(n,t);s instanceof Array?s.map(function(n){i.pushInList(a,n,{name:r})}):"string"==typeof s?i.pushInList(a,s,{name:r}):"boolean"==typeof s?i.pushInList(a,s?"true":"false",{name:r}):s?i.pushInList(a,s,{name:r}):i.pushIfNotContain(a,{name:r})})});var r=[];return Object.keys(o).map(function(n){r.push({name:i.makeWords(n),children:o[n]})}),{name:"/",children:r}},n}();r.decorators=[{type:e.Injectable}],r.ctorParameters=function(){return[]};var a=function(){function n(n,t){this.pointMaker=n,this.evaluator=t,this.evaluatedPoints={},this.interestingPoints=[],this.targetKeys=[],this.onVisualization=new e.EventEmitter}return n.prototype.sizeUp=function(n){var e=this,t=n.children&&n.children.length?n.children.length:undefined;return t&&(n.name+=n.children.length>1?" ("+t+")":"",n.children.map(function(n){e.sizeUp(n)})),n},n.prototype.triggerEvaluation=function(n,e){if(n.length&&e.length){this.d3Container.nativeElement.innerHTML="",this.evaluatedPoints=this.evaluator.evaluatePoints(this.data,n,e);var t=this.sizeUp(JSON.parse(JSON.stringify(this.evaluatedPoints)));window.initiateD3(t,"#d3-container"),this.onVisualization.emit(this.evaluatedPoints)}else this.d3Container.nativeElement.innerHTML="",this.onVisualization.emit([])},n.prototype.ngOnChanges=function(n){n.data&&(this.interestingPoints=undefined,this.targetKeys=undefined,setTimeout(this.ngOnInit.bind(this),333))},n.prototype.ngOnInit=function(){if(this.data.length&&this.enableConfiguration){var n=this.data instanceof Array?this.data[0]:this.data,e=this.pointMaker.generatePoints(n,"",!0);this.interestingPoints=e,this.targetKeys=JSON.parse(JSON.stringify(e))}this.triggerEvaluation(this.sanitize(this.interestingPoints),this.sanitize(this.targetKeys))},n.prototype.ngAfterViewInit=function(){return n=this,e=void 0,o=function(){return i(this,function(n){switch(n.label){case 0:return[4,this.loadScript("assets/d3.js","d3js")];case 1:return n.sent(),[2]}})},new((t=void 0)||(t=Promise))(function(i,r){function a(n){try{u(o.next(n))}catch(e){r(e)}}function s(n){try{u(o["throw"](n))}catch(e){r(e)}}function u(n){n.done?i(n.value):new t(function(e){e(n.value)}).then(a,s)}u((o=o.apply(n,e||[])).next())});var n,e,t,o},n.prototype.loadScript=function(n,e){return new Promise(function(t,i){if(!document.getElementById(e)){var o=document.createElement("script");o.type="text/javascript",o.src=n,o.id=e,o.onload=t,document.body.appendChild(o)}})},n.prototype.sanitize=function(n){var e=[];return n&&!n.length||n.map(function(n){n.selected&&e.push({key:n.key,value:n.value})}),e},n.prototype.onchange=function(n){this.triggerEvaluation(this.sanitize(n.points),this.sanitize(n.keys))},n}();a.decorators=[{type:e.Component,args:[{selector:"visualization-points",template:'\n<div class="configuration" *ngIf="enableConfiguration && interestingPoints">\n    <visualization-configuration\n        [interestingPoints]="interestingPoints"\n        [targetKeys]="targetKeys"\n        (onchange)="onchange($event)"></visualization-configuration>\n</div>\n<div class="d3-container" id="d3-container" #d3Container></div>\n',styles:[":host{\n  -webkit-box-sizing:border-box;\n          box-sizing:border-box;\n  display:table;\n  position:relative;\n  width:100%; }\n  :host #d3-container{\n    border:1px solid #ddd;\n    padding:5px;\n    -webkit-box-sizing:border-box;\n            box-sizing:border-box;\n    border-radius:5px;\n    background-color:#fefefe; }\n  :host ::ng-deep .node circle{\n    cursor:pointer;\n    fill:#fff;\n    stroke:steelblue;\n    stroke-width:1.5px; }\n  :host ::ng-deep .node text{\n    font-size:11px;\n    font-weight:bold; }\n  :host ::ng-deep path.link{\n    fill:none;\n    stroke:#ccc;\n    stroke-width:1.5px; }\n"]}]}],a.ctorParameters=function(){return[{type:o},{type:r}]},a.propDecorators={interestingPoints:[{type:e.Input,args:["interestingPoints"]}],targetKeys:[{type:e.Input,args:["targetKeys"]}],data:[{type:e.Input,args:["data"]}],enableConfiguration:[{type:e.Input,args:["enableConfiguration"]}],onVisualization:[{type:e.Output,args:["onVisualization"]}],d3Container:[{type:e.ViewChild,args:["d3Container"]}]};var s=function(){function n(n){this.renderer=n,this.interestingPoints=[],this.targetKeys=[],this.onchange=new e.EventEmitter}return n.prototype.keyup=function(n){13===n.which&&this.renderer.invokeElementMethod(n.target,"click")},n.prototype.click=function(n,e){var t=n.target;e.selected=t.checked,this.onchange.emit({points:this.interestingPoints,keys:this.targetKeys})},n}();s.decorators=[{type:e.Component,args:[{selector:"visualization-configuration",template:'<p class="info">\n    <span>\n        Pick points are the attributes in which you want to evaluate.\n        Target keys are the attributes in which evaluated data will be presented on.\n    </span>\n    <span>\n        For example: if you are examining users and pick user age and city as pick points,\n        data will be evaluated on city and age. And if you pick user name and gender as target keys,\n        for each age and city reference, you will see the resulting data as name and age values.</span>\n</p>\n<fieldset class="pick-points">\n    <legend>Pick Points:</legend>\n    <label *ngFor="let x of interestingPoints; let i = index" [for]="\'pickpoint\' + i">\n        <input\n            type="checkbox"\n            name="pickpoint"\n            [id]="\'pickpoint\' + i"\n            [value]="x.value"\n            [checked]="x.selected ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, x)" />\n        <span [textContent]="x.value"></span>\n    </label>\n</fieldset>\n<fieldset class="pick-points">\n    <legend>Target Keys:</legend>\n    <label *ngFor="let x of targetKeys; let i = index" [for]="\'targetKey\' + i">\n        <input\n            type="checkbox"\n            name="targetKey"\n            [id]="\'targetKey\' + i"\n            [value]="x.value"\n            [checked]="x.selected ? true: null"\n            (keyup)="keyup($event)"\n            (click)="click($event, x)" />\n        <span [textContent]="x.value"></span>\n    </label>\n</fieldset>',styles:[":host{\n  -webkit-box-sizing:border-box;\n          box-sizing:border-box;\n  display:table;\n  padding:5px; }\n  :host .info{\n    padding:5px 0;\n    margin:0;\n    font-size:0.9em; }\n  :host .pick-points{\n    -webkit-box-sizing:border-box;\n            box-sizing:border-box;\n    border:1px solid #444;\n    display:block;\n    float:left;\n    padding:0 0 5px 0;\n    width:50%;\n    margin:0;\n    border-radius:5px; }\n    :host .pick-points label{\n      display:inline-table;\n      width:33.33%; }\n      :host .pick-points label:hover{\n        color:#ca0000; }\n"]}]}],s.ctorParameters=function(){return[{type:e.Renderer}]},s.propDecorators={interestingPoints:[{type:e.Input,args:["interestingPoints"]}],targetKeys:[{type:e.Input,args:["targetKeys"]}],onchange:[{type:e.Output,args:["onchange"]}]};var u=function(){return function(){}}();u.decorators=[{type:e.NgModule,args:[{imports:[t.CommonModule],declarations:[a,s],exports:[a,s],entryComponents:[a,s],providers:[o,r],schemas:[e.CUSTOM_ELEMENTS_SCHEMA]}]}],u.ctorParameters=function(){return[]},n.VisualizationPointsComponent=a,n.VisualizationConfigurationComponent=s,n.VisualizationPointsModule=u,n.ɵb=r,n.ɵa=o,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=visualization-points.umd.min.js.map
