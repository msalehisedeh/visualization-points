!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("visualization-points",["exports","@angular/core","@angular/common"],t):t(e["visualization-points"]={},e.ng.core,e.ng.common)}(this,function(e,n,t){"use strict";function i(i,o){var r,a,l,e,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function n(e){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(l=a[2&e[0]?"return":e[0]?"throw":"next"])&&!(l=l.call(a,e[1])).done)return l;switch(a=0,l&&(e=[0,l.value]),e[0]){case 0:case 1:l=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,a=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(l=0<(l=s.trys).length&&l[l.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!l||e[1]>l[0]&&e[1]<l[3])){s.label=e[1];break}if(6===e[0]&&s.label<l[1]){s.label=l[1],l=e;break}if(l&&s.label<l[2]){s.label=l[2],s.ops.push(e);break}l[2]&&s.ops.pop(),s.trys.pop();continue}e=o.call(i,s)}catch(t){e=[6,t],a=0}finally{r=l=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}var o=function(){function e(){this.points=[]}return e.prototype.targetKeysFromGeneratedPoints=function(e,o){var r=[];return e.map(function(e){var t=e.key.split("."),n=o,i=!1;t.map(function(e){0===e.length||n instanceof Array?(n=undefined,i=!0):n=n?n[e]:n}),i||r.push(JSON.parse(JSON.stringify(e)))}),r},e.prototype.generatePoints=function(i,o,e){var r=this;return e&&(this.points=[]),null!==i&&Object.keys(i).map(function(e){var t=o.length?o+"."+e:e;if("string"==typeof i[e]||"number"==typeof i[e]||"boolean"==typeof i[e])r.points.push({key:t,value:r.makeWords(t)});else if(i[e]instanceof Array){var n=i[e];!n.length||n[0]instanceof Array||"string"==typeof n[0]?r.points.push({key:t,value:r.makeWords(t)}):r.generatePoints(n[0],t,!1)}else r.generatePoints(i[e],t,!1)}),this.points},e.prototype.makeWords=function(e){return e.replace(/\./g," ~ ").replace(/([A-Z])/g," $1").replace(/-/g," ").replace(/_/g," ").replace(/^./,function(e){return e.toUpperCase()})},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(),r=function(){function e(){}return e.prototype.pushIfNotContain=function(e,t){var n=!1;e.map(function(e){-1<e.name.indexOf(t.name)&&(n=!0)}),n||e.push(t)},e.prototype.pushInList=function(e,t,n,i,o,r){var a=this,l=undefined;t="string"==typeof(t=t instanceof Array?t.join(""):t)?t.trim().length?t:"BLANK":"boolean"==typeof t?t?"true":"false":null===t?"NULL":t,e.map(function(e){e.name===t&&(l=e,a.pushIfNotContain(e.children,r))}),null!==t&&(l?o?l.children.push(r):i&&e.push({name:t,data:n,children:[r]}):e.push({name:t,data:n,children:[r]}))},e.prototype.eveluate=function(e,i){for(var o=this,t=function(t){if((e=e?e[i[t]]:e)instanceof Array){var n=[];return e.map(function(e){n.push(o.eveluate(e,i.slice(t+1,i.length)))}),e=n,"break"}},n=0;n<i.length;n++){if("break"===t(n))break}return e},e.prototype.eveluatedNode=function(e,i){for(var o=this,t=function(t){if((e=e?e[i[t]]:e)instanceof Array){var n=[];return e.map(function(e){n.push(o.eveluate(e,i.slice(t+1,i.length)))}),e=n,"break"}},n=0;n<i.length-1;n++){if("break"===t(n))break}return e},e.prototype.makeWords=function(e){return e.replace(/([A-Z])/g," $1").replace(/-/g," ").replace(/_/g," ").replace(/^./,function(e){return e.toUpperCase()})},e.prototype.evaluatePoints=function(e,t,n,l,s){var c=this,u={};t.map(function(e){u[e.value]=[]}),e.map(function(r){var a=[];n.map(function(e){var t=e.key.split("."),n=r;t.map(function(e){n=n?n[e]:n}),n=null===n?"NULL":n,a.push(String(n))}),(a=a.length?a.join(", "):undefined)&&t.map(function(e){var t=e.key.split("."),n=u[e.value],i=c.eveluate(r,t),o=c.eveluatedNode(r,t);i instanceof Array?i.map(function(e,t){c.pushInList(n,e,o[t],l,s,{name:a})}):c.pushInList(n,i,o,l,s,{name:a})})});var i=[];return Object.keys(u).map(function(e){i.push({name:c.makeWords(e),children:u[e]})}),{name:"/",children:i}},e.decorators=[{type:n.Injectable}],e}(),a=function(){function e(e,t){this.pointMaker=e,this.evaluator=t,this.evaluatedPoints={},this.interestingPoints=[],this.targetKeys=[],this.allowduplicates=!1,this.groupduplicates=!1,this.settings={tooltipEnabled:!1,directionality:"L2R",nodeType:"Plain",targetDiv:"#d3-container",styles:{links:{"default-line-color":"gray","default-size":1,"hover-line-color":"blue","hover-line-dasharray":"5,5","hover-size":3,"selected-line-color":"red","selected-size":1},nodes:{"default-background-color":"white","default-line-color":"black","default-size":1,"hover-background-color":"lightblue","hover-line-color":"#fcb2b2","hover-line-dasharray":"5,10,5","hover-size":1.1,"selected-background-color":"orange","selected-line-color":"red","selected-size":1}}},this.onVisualization=new n.EventEmitter}return e.prototype.sizeUp=function(e){var t=this,n=e.children&&e.children.length?e.children.length:undefined;return n&&(e.name+=1<e.children.length?" ("+n+")":"",e.children.map(function(e){t.sizeUp(e)})),e},e.prototype.triggerEvaluation=function(e,t){if(e.length&&t.length){this.d3Container.nativeElement.innerHTML="",this.evaluatedPoints=this.evaluator.evaluatePoints(this.data,e,t,this.allowduplicates,this.groupduplicates);var n=this.sizeUp(JSON.parse(JSON.stringify(this.evaluatedPoints)));window.initiateD3(n,this.settings),this.onVisualization.emit(this.evaluatedPoints)}else this.d3Container.nativeElement.innerHTML="",this.onVisualization.emit([])},e.prototype.updateNodeDataRefrence=function(e,t){window.updateNodeDataRefrence(e,t)},e.prototype.startBlinking=function(){window.startBlinking(this.settings)},e.prototype.stopBlinking=function(){window.stopBlinking()},e.prototype.ngOnChanges=function(e){e.data&&(this.interestingPoints=undefined,this.targetKeys=undefined,setTimeout(this.ngOnInit.bind(this),333))},e.prototype.findReferenceStructureFrom=function(e){var n,i=0;return e.map(function(e){var t=e?Object.keys(e).length:0;i<t&&(i=t,n=e)}),n},e.prototype.ngOnInit=function(){if(this.data instanceof Array||(this.data=[this.data]),this.data.length&&this.enableConfiguration){var e=this.findReferenceStructureFrom(this.data),t=this.pointMaker.generatePoints(e,"",!0);this.interestingPoints=t,this.targetKeys=this.pointMaker.targetKeysFromGeneratedPoints(t,e)}this.triggerEvaluation(this.sanitize(this.interestingPoints),this.sanitize(this.targetKeys))},e.prototype.ngAfterViewInit=function(){return function e(t,a,l,s){return new(l||(l=Promise))(function(e,n){function i(e){try{r(s.next(e))}catch(t){n(t)}}function o(e){try{r(s["throw"](e))}catch(t){n(t)}}function r(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(i,o)}r((s=s.apply(t,a||[])).next())})}(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return window.initiateD3?[3,2]:[4,this.loadScript("assets/d3.js","d3js")];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.loadScript=function(i,e){return new Promise(function(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=i,n.onload=e,document.body.appendChild(n)})},e.prototype.sanitize=function(e){var t=[];return e&&e.length&&e.map(function(e){e.selected&&t.push({key:e.key,value:e.value})}),t},e.prototype.onchange=function(e){this.allowduplicates=e.allowduplicates,this.groupduplicates=e.groupduplicates,this.settings=e.configuration,this.triggerEvaluation(this.sanitize(e.points),this.sanitize(e.keys))},e.decorators=[{type:n.Component,args:[{selector:"visualization-points",template:'\r\n\r\n<div class="configuration" *ngIf="enableConfiguration && interestingPoints">\r\n    <visualization-configuration\r\n        [interestingPoints]="interestingPoints"\r\n        [targetKeys]="targetKeys"\r\n        [configuration]="settings"\r\n        [allowduplicates]="allowduplicates"\r\n        [groupduplicates]="groupduplicates"\r\n        (onchange)="onchange($event)"></visualization-configuration>\r\n</div>\r\n<div class="d3-container" id="d3-container" #d3Container></div>\r\n',styles:[":host{box-sizing:border-box;display:table;position:relative;width:100%}:host #d3-container{border:1px solid #633;padding:0 5px;box-sizing:border-box;border-radius:5px;background-color:#fefefe;margin:5px}:host ::ng-deep .node circle{cursor:pointer}:host ::ng-deep .node rect{cursor:pointer}:host ::ng-deep div.tooltip{position:absolute;padding:5px;font:12px sans-serif;background:#cfcfcf;border:1px solid #3a3939;border-radius:4px;pointer-events:none;z-index:5}:host ::ng-deep .node text{font-size:11px;font-weight:700}:host ::ng-deep path{fill:none}"]}]}],e.ctorParameters=function(){return[{type:o},{type:r}]},e.propDecorators={interestingPoints:[{type:n.Input,args:["interestingPoints"]}],targetKeys:[{type:n.Input,args:["targetKeys"]}],data:[{type:n.Input,args:["data"]}],allowduplicates:[{type:n.Input,args:["allowduplicates"]}],groupduplicates:[{type:n.Input,args:["groupduplicates"]}],settings:[{type:n.Input,args:["settings"]}],enableConfiguration:[{type:n.Input,args:["enableConfiguration"]}],onVisualization:[{type:n.Output,args:["onVisualization"]}],d3Container:[{type:n.ViewChild,args:["d3Container"]}]},e}(),l=function(){function e(e){this.renderer=e,this.interestingPoints=[],this.targetKeys=[],this.allowduplicates=!1,this.configuration={tooltipEnabled:!1,directionality:"L2R",nodeType:"Plain",targetDiv:"#d3-container",blinkAttributesWatch:[],styles:{links:{"default-line-color":"gray","default-size":1,"hover-line-color":"#fcb2b2","hover-line-dasharray":"5,5","hover-size":1.1,"selected-line-color":"red","selected-size":1},nodes:{"default-background-color":"white","default-line-color":"gray","default-size":1,"hover-background-color":"lightblue","hover-line-color":"#fcb2b2","hover-line-dasharray":"5,10,5","hover-size":1.1,"selected-background-color":"orange","selected-line-color":"red","selected-size":1}}},this.groupduplicates=!1,this.onchange=new n.EventEmitter}return e.prototype.keyup=function(e){13===e.which&&this.renderer.invokeElementMethod(e.target,"click")},e.prototype.chaneDirectionality=function(e){this.configuration.directionality=e.target.value,this.emitChange()},e.prototype.changeNodeType=function(e){this.configuration.nodeType=e.target.value,this.emitChange()},e.prototype.changeColorSets=function(e){1==e.target.value?(this.configuration.styles.links={"hover-line-dasharray":"5,10,5","default-size":1,"hover-size":3,"selected-size":1,"default-line-color":"lightsteelblue","hover-line-color":"#fcb2b2","selected-line-color":"red"},this.configuration.styles.nodes={"default-background-color":"white","hover-background-color":"#fcb2b2","hover-line-dasharray":"5,5","selected-background-color":"lightsteelblue","default-size":1,"hover-size":1.5,"selected-size":1.3,"default-line-color":"blue","hover-line-color":"black","selected-line-color":"red","default-label-color":"black","hover-label-color":"blue","selected-label-color":"red"}):(this.configuration.styles.links={"default-line-dasharray":"5,10,5","default-size":1.2,"hover-size":2.2,"selected-size":1.3,"default-line-color":"green","hover-line-color":"blue","selected-line-color":"#f58c24"},this.configuration.styles.nodes={"default-background-color":"yellow","default-line-dasharray":"5,5","hover-background-color":"#cad2d2","selected-background-color":"blue","default-size":1,"hover-size":2.5,"selected-size":1.9,"default-line-color":"red","hover-line-color":"blue","selected-line-color":"#f58c24","default-label-color":"black","hover-label-color":"blue","selected-label-color":"red"}),this.emitChange()},e.prototype.click=function(e,t){var n=e.target;"allowduplicates"===t?(this.allowduplicates=n.checked,this.groupduplicates=!!this.allowduplicates&&this.groupduplicates):"groupduplicates"===t?(this.groupduplicates=n.checked,this.allowduplicates=!!this.groupduplicates||this.allowduplicates):"tooltipEnabled"===t?this.configuration.tooltipEnabled=n.checked:t.selected=n.checked,this.emitChange()},e.prototype.emitChange=function(){this.onchange.emit({points:this.interestingPoints,keys:this.targetKeys,allowduplicates:this.allowduplicates,configuration:this.configuration})},e.decorators=[{type:n.Component,args:[{selector:"visualization-configuration",template:'<p class="info">\r\n    <span>\r\n        Pick points are the attributes in which you want to evaluate. \r\n        Target keys are the attributes in which evaluated data will be presented on.\r\n    </span>\r\n    <span>\r\n        For example: if you are examining users and pick user age and city as pick points, \r\n        data will be evaluated on city and age. And if you pick user name and gender as target keys, \r\n        for each age and city reference, you will see the resulting data as name and age values.</span>\r\n</p>\r\n<fieldset class="pick-points">\r\n    <legend>Target Keys:</legend>\r\n    <label *ngFor="let x of targetKeys; let i = index" [for]="\'targetKey\' + i">\r\n        <input \r\n            type="checkbox" \r\n            name="targetKey" \r\n            [id]="\'targetKey\' + i" \r\n            [value]="x.value" \r\n            [checked]="x.selected ? true: null" \r\n            (keyup)="keyup($event)"\r\n            (click)="click($event, x)" /> \r\n        <span [textContent]="x.value"></span>\r\n    </label>   \r\n</fieldset>\r\n<fieldset class="pick-points">\r\n    <legend>Pick Points:</legend>\r\n    <label *ngFor="let x of interestingPoints; let i = index" [for]="\'pickpoint\' + i">\r\n        <input\r\n            type="checkbox" \r\n            name="pickpoint" \r\n            [id]="\'pickpoint\' + i" \r\n            [value]="x.value" \r\n            [checked]="x.selected ? true: null" \r\n            (keyup)="keyup($event)"\r\n            (click)="click($event, x)" />\r\n        <span [textContent]="x.value"></span>\r\n    </label>\r\n</fieldset>\r\n<fieldset class="pick-points default">\r\n    <legend>Presentation:</legend>\r\n    <label for="directionality">Directionality:</label>\r\n    <select name="directionality" \r\n            id="directionality" \r\n            (change)="chaneDirectionality($event)">\r\n        <option value="L2R">Left to Right</option>\r\n        <option value="R2L">Right to Left</option>\r\n        <option value="TD">Top Down</option>\r\n    </select>\r\n    <label for="nodeType">Node Type:</label>\r\n    <select name="nodeType" \r\n            id="nodeType" \r\n            (change)="changeNodeType($event)">\r\n        <option value="Plain">Plain</option>\r\n        <option value="Rectangle">Rectangle</option>\r\n        <option value="Circle">Circle</option>\r\n    </select>\r\n    <label for="colorSets">Color sets:</label>\r\n    <select name="colorSets" \r\n            id="colorSets" \r\n            (change)="changeColorSets($event)">\r\n        <option value="1">Sample 1</option>\r\n        <option value="2">Sample 2</option>\r\n    </select>\r\n    <label for="tooltip">\r\n        <input\r\n            type="checkbox" \r\n            name="tooltip" \r\n            id="tooltip" \r\n            [checked]="configuration.tooltipEnabled ? true: null" \r\n            (keyup)="keyup($event)"\r\n            (click)="click($event, \'tooltipEnabled\')" />\r\n        <span>Enable Tool tip</span>\r\n    </label>\r\n</fieldset>\r\n<fieldset class="pick-points">\r\n    <legend>Duplicates In result set:</legend>\r\n    <label for="allowduplicates">\r\n        <input\r\n            type="checkbox" \r\n            name="allowduplicates" \r\n            id="allowduplicates" \r\n            [value]="allowduplicates" \r\n            [checked]="allowduplicates ? true: null" \r\n            (keyup)="keyup($event)"\r\n            (click)="click($event, \'allowduplicates\')" />\r\n        <span>Allow Duplicates</span>\r\n    </label>\r\n    <label for="groupduplicates">\r\n        <input\r\n            type="checkbox" \r\n            name="groupduplicates" \r\n            id="groupduplicates" \r\n            [value]="groupduplicates" \r\n            [checked]="groupduplicates ? true: null" \r\n            (keyup)="keyup($event)"\r\n            (click)="click($event, \'groupduplicates\')" />\r\n        <span>Group Duplicates</span>\r\n    </label>\r\n</fieldset>\r\n',styles:[":host{box-sizing:border-box;display:table;padding:5px}:host .info{padding:5px 0;margin:0;font-size:.9em}:host .pick-points{box-sizing:border-box;border:1px solid #633;display:block;float:left;padding:0 0 5px;width:100%;margin:0;border-radius:5px;background-color:#fefefe}:host .pick-points legend{font-weight:700;margin-left:20px;color:#633}:host .pick-points label{display:inline-table;width:24.33%}:host .pick-points label:hover{color:#ca0000}:host .pick-points.default label{width:15%;text-align:right}"]}]}],e.ctorParameters=function(){return[{type:n.Renderer}]},e.propDecorators={interestingPoints:[{type:n.Input,args:["interestingPoints"]}],targetKeys:[{type:n.Input,args:["targetKeys"]}],allowduplicates:[{type:n.Input,args:["allowduplicates"]}],configuration:[{type:n.Input,args:["configuration"]}],groupduplicates:[{type:n.Input,args:["groupduplicates"]}],onchange:[{type:n.Output,args:["onchange"]}]},e}(),s=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule],declarations:[a,l],exports:[a,l],entryComponents:[a,l],providers:[o,r],schemas:[n.CUSTOM_ELEMENTS_SCHEMA]}]}],e}();e.VisualizationPointsComponent=a,e.VisualizationConfigurationComponent=l,e.VisualizationPointsModule=s,e.ɵb=r,e.ɵa=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=visualization-points.umd.min.js.map